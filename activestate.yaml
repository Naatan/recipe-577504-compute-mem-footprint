# Want to find out what you can do with this file? Head over to:
# http://docs.activestate.com/platform/state/start.html
project: https://platform.activestate.com/ActiveState-Recipes/recipe-577504-compute-mem-footprint?commitID=8cbb76ab-fb54-47a6-8691-9703d7f68022
constants:
  - name: ENV
    standalone: true
    value: |
      export PATH=$PATH:/builder/home/google-cloud-sdk/bin
      export CLOUDSDK_CORE_DISABLE_PROMPTS=1

      while IFS='=' read -r -d '' n v; do
        x=`echo $n | sed -r 's/(.{5})/\1 /g'`
        printf "'%s'='%s'\n" "$n" "$v"
      done < <(env -0)
scripts:
  - name: prepare
    value: |
      ${constants.ENV}
      curl -sSL https://sdk.cloud.google.com | bash
      state auth --token `gcloud beta secrets versions access 1 --secret=ACTIVESTATE_API_KEY`
      echo "`gcloud beta secrets versions access 1 --secret=ACTIVESTATE_PRIVATE_KEY`" > $ACTIVESTATE_CLI_CONFIGDIR/private.key
  - name: recipe
    description: Runs the recipe
    value: |
      ${constants.ENV}
      python3 recipe.py | tee output
